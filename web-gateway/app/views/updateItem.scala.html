@import helper._
@import java.time.temporal.ChronoUnit
@import controllers.{Currency => Currencies}
@import com.example.auction.item.api.Item
@import com.example.auction.item.api.ItemStatus

@(itemForm: Form[ItemForm], item: Item)(implicit nav: Nav)

@renderCallout(icon: String, callout: String, msg: String) = {
    <div class="@callout callout">
        <i class="fi-@icon"></i> @Messages(msg)
    </div>
}

@main(Messages("updateItem")) {

    <h2>@Messages("updateItem")</h2>
    @item.status match{ case ItemStatus.Created => ()
        case _ => @renderCallout("like", "success", "itemLimitedEdit")
    }
    @foundationForm(itemForm, routes.ItemController.doUpdateItem(java.util.UUID.fromString(itemForm("id").value.getOrElse(java.util.UUID.randomUUID().toString)))){
        <div class="column row">
            @inputText(itemForm("title"), 'readonly -> (item.status != ItemStatus.Created) )
        </div>
        <div class="column row">
            @textarea(itemForm("description"))
        </div>
        <div class="column row">
            @select(
                field = itemForm("currency"),
                options = Currencies.values.map(c => c.name -> c.getDisplayName).sortBy(_._2),
		        'disabled -> (item.status != ItemStatus.Created)
            )
        @* todo set min and step according to the selected currency *@
        </div>
        <div class="row">
            <div class="medium-6 columns">
                @inputText(itemForm("increment"), 'type -> "number", 'min -> 0.5, 'step -> 0.5, '_help -> Messages("incrementHelp"), 'readonly -> (item.status != ItemStatus.Created))
            </div>
            <div class="medium-6 columns">
                @inputText(itemForm("reserve"), 'type -> "number", 'min -> 0, 'step -> 0.5, '_help -> Messages("reserveHelp"), 'readonly -> (item.status != ItemStatus.Created))
            </div>
        </div>
        <div class="row">
            <div class="medium-6 columns">
                @inputText(itemForm("duration"), 'type -> "number", 'readonly -> (item.status != ItemStatus.Created), 'min -> 1, 'step -> 1, '_columns -> 3)
            </div>
            <div class="medium-6 columns">
                @select(
                    field = itemForm("durationUnits"),
                    options = ChronoUnit.values().dropWhile(_ != ChronoUnit.SECONDS).takeWhile(_ != ChronoUnit.MONTHS).map(u => u.name() -> u.toString()),
                    '_columns -> 3,
		            'disabled -> (item.status != ItemStatus.Created)
                )
            </div>
        </div>
        <input type="submit" class="button" value="@Messages("updateItem")"/>
    }
}
